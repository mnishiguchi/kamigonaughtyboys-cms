{{/* https://github.com/craigbuckler/progressive-image.js */}}
{{/* https://gohugo.io/content-management/image-processing/ */}}
{{/* https://discourse.gohugo.io/t/solved-media-in-separate-folder-and-accessing-with-page-resources/11756/5 */}}
{{/*
  Examples

      {{ partial "progressive-image.html" (dict "context" . "src" .Params.image "alt" .Title) }}

  */}}

{{ $headless_bundle := .context.Site.GetPage "page" "images" }}
{{ $original := ($headless_bundle.Resources.GetMatch (strings.TrimPrefix "/images/" .src)) }}

{{ if $original }}
  {{ $small := ($original.Resize "20x") }}
  <a href="{{ $original.RelPermalink }}" class="progressive replace">
    <img class="preview" src="{{ $small.RelPermalink }}" width="{{ $small.Width }}" height="{{ $small.Height }}">
  </a>
{{ else }}
  <img src="{{ .src }}" alt="{{ .alt }}">
{{ end }}
